<!DOCTYPE html>
<html>
<head>
    <title>Admin Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial;
            background: #f4f6f9;
            margin: 20px;
        }

        h2 {
            color: #0077ff;
        }

        .card {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .stats {
            display: flex;
            justify-content: space-between;
        }

        canvas {
            margin-top: 20px;
        }
    </style>
</head>

<body>

<h2>ðŸ“Š Admin Analytics Dashboard</h2>

<div class="card stats">
    <div>
        <h3>Total Appointments</h3>
        <h1 id="total">0</h1>
    </div>
    <div>
        <h3>Today's Appointments</h3>
        <h1 id="today">0</h1>
    </div>
</div>

<div class="card">
    <h3>Doctor Wise</h3>
    <canvas id="doctorChart"></canvas>
</div>

<div class="card">
    <h3>Monthly</h3>
    <canvas id="monthlyChart"></canvas>
</div>

<div class="card">
    <h3>Hospital Wise</h3>
    <canvas id="hospitalChart"></canvas>
</div>

<script>
async function loadAnalytics() {

    const res = await fetch("/analytics_data");
    const data = await res.json();

    document.getElementById("total").innerText = data.total;
    document.getElementById("today").innerText = data.today;

    // Doctor Chart
    const doctorNames = data.doctor_data.map(d => d[0]);
    const doctorCounts = data.doctor_data.map(d => d[1]);

    new Chart(document.getElementById("doctorChart"), {
        type: "bar",
        data: {
            labels: doctorNames,
            datasets: [{
                label: "Appointments",
                data: doctorCounts,
                backgroundColor: "#36A2EB"
            }]
        }
    });

    // Monthly Chart
    const months = data.monthly_data.map(m => m[0]);
    const monthCounts = data.monthly_data.map(m => m[1]);

    new Chart(document.getElementById("monthlyChart"), {
        type: "line",
        data: {
            labels: months,
            datasets: [{
                label: "Monthly",
                data: monthCounts,
                borderColor: "green",
                fill: false
            }]
        }
    });

    // Hospital Chart
    const hospitalNames = data.hospital_data.map(h => h[0]);
    const hospitalCounts = data.hospital_data.map(h => h[1]);

    new Chart(document.getElementById("hospitalChart"), {
        type: "pie",
        data: {
            labels: hospitalNames,
            datasets: [{
                data: hospitalCounts,
                backgroundColor: ["red","blue","orange","purple","green"]
            }]
        }
    });
}

loadAnalytics();
</script>

</body>
</html>